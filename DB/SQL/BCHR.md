### 메모리 I/O vs. 디스크 I/O
#### I/O 효율화 튜닝의 중요성
모든 DBMS는 읽고자 하는 블록을 먼저 버퍼 캐시에서 찾아보고 없을 경우 디스크에서 읽어 버퍼 캐시에 적재한 후 읽기/쓰기 작업을 수행한다.

- 디스크 I/O : 디스크의 액세스 암이 움직이면서 헤드를 통해 데이터를 읽기/쓰기. 상대적으로 느림
- 메모리 I/O : 전기적 신호를 통해 데이터를 읽기/쓰기. 상대적으로 매우 빠름.

무리적인 디스크 I/O가 필요할 때 서버 프로세스는 시스템에 I/O Call을 하고 잠시 대기 상태에 빠진다. 디스크 I/O 경합이 심할수록 대기 시간도 길어진다. 디스크 I/O를 최소화하고 버퍼 캐시 효율을 높이는 것이 데이터베이스 I/O 튜닝의 목표가 된다.

#### Buffer Cache Hit Ratio(BCHR)
버퍼 캐시 히트율은 물리적인 디스크 읽기를 수반하지 않고 <B>메모리에서 블록을 찾은 비율</B>을 말한다. Direct Path Read 방식 이외의 모든 블록 읽기는 버퍼 캐시를 통해 이뤄진다.

```
BCHR = (버퍼 캐시에서 곧바로 찾은 블록 수 / 총 읽은 블록 수) * 100(%)
```

BCHR은 주로 시스템 전체적인 관점에서 측정하나, 개별 SQL 측면에서도 구해볼 수도 있다.

```
call     count       cpu    elapsed       disk      query    current        rows
------- ------  -------- ---------- ---------- ---------- ----------  ----------
Parse       15      0.00       0.08          0          0          0           0
Execute     44      0.03       0.03          0          0          0           0
Fetch       44      0.01       0.13         18        822          0          44
------- ------  -------- ---------- ---------- ---------- ----------  ----------
total      103      0.04       0.25         18        822          0          44
```
- disk : 디스크를 경유한 블록 수 = 물리적 I/O로 읽은 블록 개수
- query + currunt : 버퍼 캐시에서 찾은 블록 수 = 총 읽은 블록 수

따라서 BCHR를 구하는 공식에 위에서 찾은 정보를 대입하면 다음과 같이 BCHR이 98%임을 알 수 있다.

```
BCHR = (버퍼 캐시에서 곧바로 찾은 블록 수 / 총 읽은 블록 수) * 100(%)
     = {(query + currunt) - (disk)} / (query + current) * 100(%)
     = (822 - 18) / 822 * 100(%)
     = 98(%)
```

모든 블록 읽기는 Buffer Cache에 적재된 후 수행되니 결국 BCHR을 구하는 공식을 다음과 같이 나타낼 수 있다.

```
BCHR = (버퍼 캐시에서 곧바로 찾은 블록 수 / 총 읽은 블록 수) * 100(%)
     = (논리적 I/O - 물리적 I/O) / 논리적 I/O * 100(%)
     = (1 - 물리적 I/O / 논리적 I/O ) * 100(%)
```

그리고 이를 물리적 I/O에 관하여 정리하면 다음과 같이 나타낼 수 있다.

```
물리적 I/O = { 논리적 I/O * (100 - BCHR) } / 100
```

중요한 것은 물리적인 I/O로 인해 읽은 블록을 구하는 것이 아니라 물리적 I/O는 BCHR 등 시스템 전체 캐시 상태에 의존하여 달라지는 값이라는 점이다.
즉, BCHR을 높이기 위해서 물리적 I/O를 줄여야 할 거 같지만, 통제 가능한 논리적 I/O를 줄여야 한다는 의미이다. 논리적 I/O를 줄이기위해서는 SQL Tuning을 통해 액세스하는 블록의 수를 줄여야 한다.


성능지표로서의 BCHR
- 디스크 I/O 대비 메모리 I/O의 속도 차이로 인한 전체 I/O 성능 상태를 점검하기 위해 사용
- 모든 블록 읽기는 Buffer Cache를 통해 이루어지므로, 논리적 I/O가 많은 SQL이더라도 같은 블록에 대한 반복 조회가 이루어진다면 BCHR은 높게 측정됨
- BCHR가 높게 측정된다고 I/O 효율이 좋은 것은 아니나, 낮게 측정된 BCHR은 SQL 성능을 떨어뜨리는 주원인일 가능성이 높음
