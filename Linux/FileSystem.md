## 파일 시스템
File System : 운영체제가 파티션이나 디스크에 데이터를 저장하고 읽고 쓰고 찾기 위해 구성하는 일련의 체계

<b>파일 시스템의 기능</b>
- 사용자가 파일을 생성(Create), 수정(Modify), 삭제(Delete)할 수 있도록 제공
- 사용자가 파일을 사용하기 적합한 형태의 구조로 구성하고, 다양한 추가 정보 제공
- 다른 사용자와의 파일을 공동으로 사용할 수 있는 적절한 제어 방법 제공
- 파일 공유를 위하여 판독 접근, 기록 접근, 수행 접근 등의 다양한 접근 제어 방법 제공
- 정보 손실이나 파괴를 방지하기 위하여 백업(Backup)이나 복구(Recovery)를 위한 기능 준비
- 사용자와 장치 간의 독립성(device independence)을 유지하기 위해, 물리적인 장치 이름 대신 적절한 이름 제공
- 정보가 안전하게 보호되고 비밀이 보장될 수 있도록 정보의 암호화(encryption) 및 복호화(decryption) 기능 제공
- 사용자가 파일이나 디렉터리에 접근하기 쉬운 인터페이스 및 명령어 제공

### 리눅스 파일 시스템
<table>
<tr><td>minix</td><td>
<ui><li>Minix 운영체제에 사용된 파일 시스템으로, 초기 리눅스 파일 시스템의 모태<li>파티션 사이즈 64MB 제한, 파일 이름 14까지 지원<li>단일스탬프(Timestamp) 체제</ui>
</td></tr>
<tr><td>ext</td><td><ui><li>유닉스 파일 시스템 UFS 구조를 기반으로 Minix를 개선<li>최대 파티션 크기 2GB와 파일명 255자까지 가능<li>파일 접근에 대한 타임스탬프, 아이노드 수정 등은 지원하지 않음</ui></td></tr>
<tr><td>ext2</td><td><ui><li>ext의 아이노드 불변성과 타임스탬프 수정 문제를 해결<li>이론적으로 1K 블록을 사용했을 경우 최대 16GB의 단일 파일 생성, 최대 4TB의 파일 시스템으로 구성할 수 있으나, 응용 프로그램과의 호환성 문제로 2GB까지의 단일 파일생성만 지원</ui></td></tr>
<tr><td>ext3</td><td><ul><li>4K 블록을 사용했을경우 최대 2TB의 단일 파일 생성, 16TB의 파일 시스템 구성이 가능<li>저널링 지원<li>ACL(Access Control List)를 통한 접근 제어 지원<li>ext2와 대부분 호환 가능</ul></td></tr>
<tr><td>ext4</td><td><ul><li>ext2, ext3와 호환성이 있는 확장 버전
<li>대형 파일 시스템 관련 기능이 강화됨
  
  - 64비트 기억 공간 제한을 없애고, 최대 1EB의 디스크 볼륨과 16TB의 파일을 지원</ul>
</td></tr>
</table>

#### 저널링 파일 시스템
파일 시스템에 대한 변경사항을 반영하기 전에 저널이라 부르는 로그에 변경사항을 저장하여 추적이 가능하게 만든 파일 시스템
- 시스템에 충돌현상이 발생하거나 전원 문제가 발생된 경우 데이터 복구 확률을 높임
- 파일을 실제로 수정하기 전에 로그에 수정된 내용을 저장해서 비정상적으로 동작이 멈추었더라도 시스템 복구를 위해 단지 로그만 검사하면 됨
  - 로그 정보를 바탕으로 수정 내용을 적용하므로 속도와 복구의 안정성면에서 뛰어난 성능
- ext3, ext4, XFS, JFS, ReiserFS 등이 이에 해당

#### ext(Extended File System) 파일 시스템 구조

일반적으로 디스크 드라이브 이용 시 파티션을 분할하고 포맷을 통해 파일 시스템을 생성

![mkfs](https://github.com/dee021/TIL/blob/linuxmaster/Linux/img/mkfs.jpg)

저장되는 정보는 Directory Blocks and Data Blocks 영역에 저장됨
- 디렉터리 블록에는 아이노드 번호와 파일명이 저장됨
- 데이터 블록에는 파일이 보관해야할 정보를 저장됨

![dataBlocks](https://github.com/dee021/TIL/blob/linuxmaster/Linux/img/datablocks.jpg)

> <b>아이노드(Inode)</b>
> 전통적인 유닉스 계열 시스템에서 사용하는 일종의 자료 구조<br>
> 각각의 파일은 하나의 아이노드를 할당받아 관리된다.
>
> 아이노드 넘버(Inode Number), 접근 모드(읽기, 쓰기, 실행 권한), 파일 형식(파일, 디렉터리, 블록 및 캐릭터 디바이스 등), 소유자 정보(소유자와 그룹에 대한 식별자), 파일 크기, 타임스탬프 등의 정보를 저장

<b>etx2 파일 시스템</b>

![ext2](https://github.com/dee021/TIL/blob/linuxmaster/Linux/img/ext2.jpg)
- 슈퍼 블록(Super Block) : 파일 시스템에 대한 전체적인 정보를 담고 있음.
  - 매직 넘버(Magic Number) : 특정 파일 시스템임을 알리는 정보. ext 파일 시스템인 경우 0xEF53
  - 마운트 정보, 전체 아이노드 수 및 남은 수, 전체 블록 수 및 남은 수, 블록 그룹 번호, 블록 크기, 그룹 당 블록 수
- 그룹 기술자(Group Descriptor) : 각각의 블록 그룹을 기술하는 자료 구조
  - 블록 비트맵, 아이노드 비트맵, 아이노드 테이블(아이노드 블록)
- 블록 비트맵(Block Bitmap) : 블록의 사용 현황을 Bit로 표현
  - 각 디스크 블록 당 하나의 비트가 할당되어 관리됨
  - 해당 블록이 자유 공간이면 1, 할당되어 있으면 0으로 표기
- 아이노드 비트맵(Inode Bitmap) : 하이노드 할당 상태를 Bit로 표현 
- 아이노드 테이블(Inode Table, 아이노드 블록) : 아이노드에 대한 정보가 들어있는 영역
  - 'ls -l' 명령 실행 시나타내는 정보인 파일 유형, 접근 권한, 하드링크 수, 소유자, 소유 그룹명, 파일 크기, 날짜 관련 정보, 파일명 등을 저장
- 데이터 블록 : 파일이 보관해야 하는 정보를 저장하는 영역으로 파일의 데이터가 존재
- 간접 블록(Indirection Block) : 추가적인 데이터 블록을 위한 포인터들이 사용할 동적으로 할당되는 공간
- 홀(Hole) : 아이노드나 간접 블록 안의 데이터 블록의 주소로 특별한 값을 저장
  - 파일 시스템에 의해 파일 안에 자리하나, 실질적으로 디스크 상에 공간을 할당되지 않음

#### XFS
주요 특징
- B+ 트리 구조를 사용하는 파일 시스템
- 빠른 복구를 위해 메타데이터 저널링을 지원한다.
- 마운트되어 활성화된 상태로 조각 모음 및 확장 지원한다.
- 데이터 읽기/쓰기 트랜잭션으로 인한 성능 저하를 최소화한다. XFS의 저널링 구조와 알고리즘은 트랜잭션에 대한 로그 기록을 신속하게 할 수 있도록 최적화되어 있다.
- raw I/O 성능에 가까운 성능을 낼 수 있는 뛰어난 처리량을 보인다.
- 완전한 64비트 파일 시스템이기 때문에 높은 확장성을 제공한다.

- 최대 16EB의 디스크볼륨과 8EB의 파일 지원
- 레드햇 계열인 RHEL 7의 기본 파일시스템으로 제공 

<b>XFS의 할당 체계</b><br>
XFS는 익스텐트(extent) 기반 할당을 사용하여 지연 할당 및 명시적인 사전 할당과 같은 여러 할당 체계를 갖고 있음

- 지연 할당은 파일이 연속적인 블록 그룹에 기록될 가능성을 높이는 것으로 단편화를 줄이고 성능을 향상시킴
- 사전 할당은 애플리케이션이 사전에 기록해야 할 데이터양을 알고 있는 경우 완전히 조각화하는 것을 방지하는 데 사용

<b>XFS 데몬</b><br>
XFS는 기본적으로 xfssyncd, xfsbufd, xfddatad, xfslogd 4 종류의 데몬을 이용

- xfssyncd : 로그 정보와 메타 데이터 정보들을 기록하는 역할 수행
- xfsbufd : I/O요청 처리
- xfsdatad, xfslogd : 작업 큐에 수행할 작업이 있는 경우 관련 함수를 호출하여 수행하는 역할
